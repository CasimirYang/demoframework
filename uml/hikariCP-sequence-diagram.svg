<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1195.64px" preserveAspectRatio="none" style="width:1851px;height:1195px;background:#EEEBDC;" version="1.1" viewBox="0 0 1851 1195" width="1851.6799px" zoomAndPan="magnify"><defs><filter height="300%" id="fbk6s4a3plt9a" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.4199999570846558"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.8399999141693115" dy="2.8399999141693115" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="9.94" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173.95" x="838.3325" y="18.4912">HikariCP DataSource init Sequence</text><rect fill="#DDDDDD" height="1162.0547" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="1032.34" x="105.79" y="26.3553"/><text fill="#000000" font-family="sans-serif" font-size="9.23" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38.34" x="602.79" y="36.9328">hikariCP</text><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="1064.9629" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="150.52" y="75.9662"/><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="923.1248" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="316.66" y="186.0287"/><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="439.0168" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="523.98" y="208.5743"/><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="252.4362" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="1279.775" y="395.1549"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="154.07" x2="154.07" y1="68.8662" y2="1159.2147"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="320.21" x2="320.21" y1="68.8662" y2="1159.2147"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="527.175" x2="527.175" y1="68.8662" y2="1159.2147"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="980.51" x2="980.51" y1="68.8662" y2="1159.2147"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="1080.62" x2="1080.62" y1="68.8662" y2="1159.2147"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="1283.325" x2="1283.325" y1="68.8662" y2="1159.2147"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="1449.465" x2="1449.465" y1="68.8662" y2="1159.2147"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 5.0,5.0;" x1="1670.9849" x2="1670.9849" y1="68.8662" y2="1159.2147"/><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="88.04" x="108.63" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="78.1" x="113.6" y="58.1621">HikariDataSource</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="88.04" x="108.63" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="78.1" x="113.6" y="1174.8659">HikariDataSource</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="76.68" x="280.45" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="66.74" x="285.42" y="58.1621">pool.HikariPool</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="76.68" x="280.45" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="66.74" x="285.42" y="1174.8659">pool.HikariPool</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="74.55" x="488.835" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="64.61" x="493.805" y="58.1621">pool.PoolBase</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="74.55" x="488.835" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="64.61" x="493.805" y="1174.8659">pool.PoolBase</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="75.26" x="941.46" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="65.32" x="946.43" y="58.1621">pool.PoolEntry</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="75.26" x="941.46" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="65.32" x="946.43" y="1174.8659">pool.PoolEntry</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="105.79" x="1026.66" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="95.85" x="1031.63" y="58.1621">util.DriverDataSource</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="105.79" x="1026.66" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="95.85" x="1031.63" y="1174.8659">util.DriverDataSource</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="113.6" x="1225.105" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="103.66" x="1230.075" y="58.1621">java.sql.DriverManager</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="113.6" x="1225.105" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="103.66" x="1230.075" y="1174.8659">java.sql.DriverManager</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="112.18" x="1391.955" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="102.24" x="1396.925" y="58.1621">java.util.ServiceLoader</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="112.18" x="1391.955" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="102.24" x="1396.925" y="1174.8659">java.util.ServiceLoader</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="107.92" x="1615.605" y="41.8009"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="97.98" x="1620.575" y="58.1621">com.mysql.jdbc.Driver</text><rect fill="#FEFECE" filter="url(#fbk6s4a3plt9a)" height="23.5153" style="stroke: #A80036; stroke-width: 1.0649999678134918;" width="107.92" x="1615.605" y="1158.5047"/><text fill="#000000" font-family="sans-serif" font-size="9.94" lengthAdjust="spacingAndGlyphs" textLength="97.98" x="1620.575" y="1174.8659">com.mysql.jdbc.Driver</text><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="1064.9629" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="150.52" y="75.9662"/><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="923.1248" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="316.66" y="186.0287"/><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="439.0168" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="523.98" y="208.5743"/><rect fill="#FFFFFF" filter="url(#fbk6s4a3plt9a)" height="252.4362" style="stroke: #A80036; stroke-width: 0.7099999785423279;" width="7.1" x="1279.775" y="395.1549"/><path d="M5.68,79.5162 L5.68,98.6862 L144.13,98.6862 L144.13,86.6162 L137.03,79.5162 L5.68,79.5162 " fill="#FBFB77" filter="url(#fbk6s4a3plt9a)" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><path d="M137.03,79.5162 L137.03,86.6162 L144.13,86.6162 L137.03,79.5162 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="123.54" x="9.94" y="93.6437">new HikariDataSource(config);</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="157.62" x2="187.44" y1="122.4774" y2="122.4774"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="187.44" x2="187.44" y1="122.4774" y2="131.7074"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="158.33" x2="187.44" y1="131.7074" y2="131.7074"/><polygon fill="#A80036" points="165.43,128.8674,158.33,131.7074,165.43,134.5474,162.59,131.7074" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="70.29" x="162.59" y="119.0293">校验config的参数</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="157.62" x2="187.44" y1="154.253" y2="154.253"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="187.44" x2="187.44" y1="154.253" y2="163.483"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="158.33" x2="187.44" y1="163.483" y2="163.483"/><polygon fill="#A80036" points="165.43,160.643,158.33,163.483,165.43,166.323,162.59,163.483" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="36.92" x="162.59" y="150.805">属性设置</text><polygon fill="#A80036" points="308.14,183.1887,315.24,186.0287,308.14,188.8687,310.98,186.0287" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="157.62" x2="312.4" y1="186.0287" y2="186.0287"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="80.94" x="162.59" y="182.5806">new pool.HikariPool</text><polygon fill="#A80036" points="515.46,205.7343,522.56,208.5743,515.46,211.4143,518.3,208.5743" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="519.72" y1="208.5743" y2="208.5743"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="85.91" x="328.73" y="205.1262">invodke super(config)</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="531.08" x2="560.9" y1="231.1199" y2="231.1199"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="560.9" x2="560.9" y1="231.1199" y2="240.3499"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="531.79" x2="560.9" y1="240.3499" y2="240.3499"/><polygon fill="#A80036" points="538.89,237.5099,531.79,240.3499,538.89,243.1899,536.05,240.3499" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="84.49" x="536.05" y="227.6718">initializeDataSource:</text><path d="M534.63,249.5799 L534.63,307.0899 L783.84,307.0899 L783.84,256.6799 L776.74,249.5799 L534.63,249.5799 " fill="#FBFB77" filter="url(#fbk6s4a3plt9a)" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><path d="M776.74,249.5799 L776.74,256.6799 L783.84,256.6799 L776.74,249.5799 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="44.73" x="538.89" y="263.7074">1.属性设置</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="231.46" x="541.73" y="276.3131">2.根据dsClassName,jdbcUrl,JNDI的顺序获取DataSource</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="78.1" x="541.73" y="288.9187">3.set LoginTimeout</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="105.79" x="541.73" y="301.5243">4.set netTimeoutExecutor</text><path d="M534.63,317.0424 L534.63,336.2124 L857.68,336.2124 L857.68,324.1424 L850.58,317.0424 L534.63,317.0424 " fill="#FBFB77" filter="url(#fbk6s4a3plt9a)" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><path d="M850.58,317.0424 L850.58,324.1424 L857.68,324.1424 L850.58,317.0424 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="308.14" x="538.89" y="331.1699">根据设置的DataSourceClassName,jdbcUrl,DataSourceJNDI的顺序进行加载</text><polygon fill="#A80036" points="1072.455,369.7692,1079.555,372.6092,1072.455,375.4492,1075.295,372.6092" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="531.08" x2="1076.715" y1="372.6092" y2="372.6092"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="68.16" x="536.05" y="356.5555">使用jdbcUrl方式:</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="384.11" x="538.89" y="369.1612">new DriverDataSource(jdbcUrl, driverClassName, dataSourceProperties, username, password)</text><polygon fill="#A80036" points="1271.255,392.3149,1278.355,395.1549,1271.255,397.9949,1274.095,395.1549" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1080.975" x2="1275.515" y1="395.1549" y2="395.1549"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="163.3" x="1085.945" y="391.7068">driver = DriverManager.getDriver(jdbcUrl)</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1286.875" x2="1316.695" y1="417.7005" y2="417.7005"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1316.695" x2="1316.695" y1="417.7005" y2="426.9305"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1287.585" x2="1316.695" y1="426.9305" y2="426.9305"/><polygon fill="#A80036" points="1294.685,424.0905,1287.585,426.9305,1294.685,429.7705,1291.845,426.9305" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="46.15" x="1291.845" y="414.2524">触发类加载</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1286.875" x2="1316.695" y1="449.4761" y2="449.4761"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1316.695" x2="1316.695" y1="449.4761" y2="458.7061"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1287.585" x2="1316.695" y1="458.7061" y2="458.7061"/><polygon fill="#A80036" points="1294.685,455.8661,1287.585,458.7061,1294.685,461.5461,1291.845,458.7061" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="149.1" x="1291.845" y="446.028">静态代码块执行loadInitialDrivers方法</text><polygon fill="#A80036" points="1440.945,478.4117,1448.045,481.2517,1440.945,484.0917,1443.785,481.2517" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1286.875" x2="1445.205" y1="481.2517" y2="481.2517"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="130.64" x="1291.845" y="477.8036">ServiceLoader.load(Driver.class)</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1449.465" x2="1479.285" y1="503.7973" y2="503.7973"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1479.285" x2="1479.285" y1="503.7973" y2="513.0273"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1450.175" x2="1479.285" y1="513.0273" y2="513.0273"/><polygon fill="#A80036" points="1457.275,510.1873,1450.175,513.0273,1457.275,515.8673,1454.435,513.0273" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="211.58" x="1454.435" y="500.3493">使用currentThread的contextClassLoader进行类加载</text><polygon fill="#A80036" points="1662.4649,532.733,1669.5649,535.573,1662.4649,538.413,1665.3049,535.573" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1449.465" x2="1666.7249" y1="535.573" y2="535.573"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="46.15" x="1454.435" y="532.1249">触发类加载</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1670.9849" x2="1700.8049" y1="570.7242" y2="570.7242"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1700.8049" x2="1700.8049" y1="570.7242" y2="579.9542"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="1671.6949" x2="1700.8049" y1="579.9542" y2="579.9542"/><polygon fill="#A80036" points="1678.7949,577.1142,1671.6949,579.9542,1678.7949,582.7942,1675.9549,579.9542" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="92.3" x="1675.9549" y="554.6705">静态代码块执行注册：</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="167.56" x="1675.9549" y="567.2761">DriverManager.registerDriver(new Driver())</text><polygon fill="#A80036" points="1294.685,599.6598,1287.585,602.4998,1294.685,605.3398,1291.845,602.4998" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="1290.425" x2="1670.2749" y1="602.4998" y2="602.4998"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="98.69" x="1298.945" y="599.0517">注册到 registeredDrivers</text><polygon fill="#A80036" points="1088.785,622.2054,1081.685,625.0454,1088.785,627.8854,1085.945,625.0454" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="1084.525" x2="1279.065" y1="625.0454" y2="625.0454"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="181.76" x="1093.045" y="621.5974">从注册的registeredDrivers中返回合适的driver</text><polygon fill="#A80036" points="535.34,644.751,528.24,647.591,535.34,650.431,532.5,647.591" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="531.08" x2="1080.265" y1="647.591" y2="647.591"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="83.78" x="539.6" y="644.143">set dadaSource field</text><polygon fill="#A80036" points="519.01,667.2967,526.11,670.1367,519.01,672.9767,521.85,670.1367" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="323.76" x2="523.27" y1="670.1367" y2="670.1367"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="56.8" x="328.73" y="666.6886">newPoolEntry</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="527.53" x2="557.35" y1="755.7104" y2="755.7104"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="557.35" x2="557.35" y1="755.7104" y2="764.9404"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="528.24" x2="557.35" y1="764.9404" y2="764.9404"/><polygon fill="#A80036" points="535.34,762.1004,528.24,764.9404,535.34,767.7804,532.5,764.9404" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="62.48" x="532.5" y="689.2342">newConnection</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="122.12" x="538.18" y="701.8398">1.dataSource.getConnection()</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="76.68" x="538.18" y="714.4455">2.setupConnection</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="356.42" x="538.18" y="727.0511">2.1设置validationTimeout，isReadOnly，isAutoCommit，transactionIsolation，schema</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="434.52" x="538.18" y="739.6567">2.2 Execute isValid() or connection test query. 如果驱动支持JDBC4，HikariCP 强烈建议使用JDBC4做test</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="228.62" x="538.18" y="752.2623">2.3 执行ConnectionInitSql 如果已经配置（默认没配置）</text><polygon fill="#A80036" points="971.99,784.646,979.09,787.486,971.99,790.326,974.83,787.486" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="527.53" x2="976.25" y1="787.486" y2="787.486"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="129.93" x="532.5" y="784.0379">new PoolEntry(connection,pool)</text><polygon fill="#A80036" points="331.57,807.1916,324.47,810.0316,331.57,812.8716,328.73,810.0316" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="327.31" x2="979.8" y1="810.0316" y2="810.0316"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="39.05" x="335.83" y="806.5835">poolEntry</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="353.58" y1="832.5772" y2="832.5772"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="353.58" x2="353.58" y1="832.5772" y2="841.8072"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="324.47" x2="353.58" y1="841.8072" y2="841.8072"/><polygon fill="#A80036" points="331.57,838.9672,324.47,841.8072,331.57,844.6472,328.73,841.8072" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="186.02" x="328.73" y="829.1292">poolEntry在lifetime后执行softEvictConnection</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="323.76" x2="353.58" y1="864.3529" y2="864.3529"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="353.58" x2="353.58" y1="864.3529" y2="873.5829"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279; stroke-dasharray: 2.0,2.0;" x1="324.47" x2="353.58" y1="873.5829" y2="873.5829"/><polygon fill="#A80036" points="331.57,870.7429,324.47,873.5829,331.57,876.4229,328.73,873.5829" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="141.29" x="328.73" y="860.9048">add to ConcurrentBag&lt;PoolEntry&gt;</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="353.58" y1="896.1285" y2="896.1285"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="353.58" x2="353.58" y1="896.1285" y2="905.3585"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="324.47" x2="353.58" y1="905.3585" y2="905.3585"/><polygon fill="#A80036" points="331.57,902.5185,324.47,905.3585,331.57,908.1985,328.73,905.3585" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="64.61" x="328.73" y="892.6804">registerMBeans</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="353.58" y1="953.1153" y2="953.1153"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="353.58" x2="353.58" y1="953.1153" y2="962.3453"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="324.47" x2="353.58" y1="962.3453" y2="962.3453"/><polygon fill="#A80036" points="331.57,959.5053,324.47,962.3453,331.57,965.1853,328.73,962.3453" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="171.82" x="328.73" y="924.456">初始化addConnectionExecutor给后续使用</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="73.84" x="331.57" y="937.0616">1.createPoolEntry</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="97.27" x="331.57" y="949.6673">2.add to connectionBag</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="353.58" y1="1010.1022" y2="1010.1022"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="353.58" x2="353.58" y1="1010.1022" y2="1019.3322"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="324.47" x2="353.58" y1="1019.3322" y2="1019.3322"/><polygon fill="#A80036" points="331.57,1016.4922,324.47,1019.3322,331.57,1022.1722,328.73,1019.3322" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="178.92" x="328.73" y="981.4429">初始化closeConnectionExecutor给后续使用</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="104.37" x="331.57" y="994.0485">1.quietlyCloseConnection</text><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="37.63" x="331.57" y="1006.6541">2. fillPool</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="353.58" y1="1041.8778" y2="1041.8778"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="353.58" x2="353.58" y1="1041.8778" y2="1051.1078"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="324.47" x2="353.58" y1="1051.1078" y2="1051.1078"/><polygon fill="#A80036" points="331.57,1048.2678,324.47,1051.1078,331.57,1053.9478,328.73,1051.1078" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="184.6" x="328.73" y="1038.4297">开启定时任务HouseKeeper维护最小空闲连接</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="353.58" y1="1073.6534" y2="1073.6534"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="353.58" x2="353.58" y1="1073.6534" y2="1082.8834"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="324.47" x2="353.58" y1="1082.8834" y2="1082.8834"/><polygon fill="#A80036" points="331.57,1080.0434,324.47,1082.8834,331.57,1085.7234,328.73,1082.8834" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="190.28" x="328.73" y="1070.2054">初始化泄露检查工厂类 ProxyLeakTaskFactory</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="323.76" x2="353.58" y1="1108.9791" y2="1108.9791"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="353.58" x2="353.58" y1="1108.9791" y2="1118.2091"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="320.21" x2="353.58" y1="1118.2091" y2="1118.2091"/><polygon fill="#A80036" points="327.31,1115.3691,320.21,1118.2091,327.31,1121.0491,324.47,1118.2091" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="178.92" x="328.73" y="1105.531">根据InitializationFailTimeout配置等待初始化</text><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="157.62" x2="187.44" y1="1140.7547" y2="1140.7547"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="187.44" x2="187.44" y1="1140.7547" y2="1149.9847"/><line style="stroke: #A80036; stroke-width: 0.7099999785423279;" x1="154.07" x2="187.44" y1="1149.9847" y2="1149.9847"/><polygon fill="#A80036" points="161.17,1147.1447,154.07,1149.9847,161.17,1152.8247,158.33,1149.9847" style="stroke: #A80036; stroke-width: 0.7099999785423279;"/><text fill="#000000" font-family="sans-serif" font-size="9.23" lengthAdjust="spacingAndGlyphs" textLength="149.1" x="162.59" y="1137.3066">标记seal= true 标记DS已经成功启动</text><!--
@startuml
skinparam backgroundColor #EEEBDC

title HikariCP DataSource init Sequence



box "hikariCP"
participant HikariDataSource
participant pool.HikariPool
participant pool.PoolBase
participant pool.PoolEntry
note left of HikariDataSource:new HikariDataSource(config);
activate HikariDataSource
HikariDataSource -> HikariDataSource: 校验config的参数
HikariDataSource -> HikariDataSource: 属性设置

HikariDataSource->pool.HikariPool: new pool.HikariPool
activate pool.HikariPool
pool.HikariPool->pool.PoolBase: invodke super(config)
activate pool.PoolBase
pool.PoolBase->pool.PoolBase: initializeDataSource:
note right of pool.PoolBase:  1.属性设置 \n 2.根据dsClassName,jdbcUrl,JNDI的顺序获取DataSource\n 3.set LoginTimeout \n 4.set netTimeoutExecutor
note right of pool.PoolBase: 根据设置的DataSourceClassName,jdbcUrl,DataSourceJNDI的顺序进行加载
pool.PoolBase->util.DriverDataSource: 使用jdbcUrl方式: \n new DriverDataSource(jdbcUrl, driverClassName, dataSourceProperties, username, password)
end box

util.DriverDataSource->"java.sql.DriverManager" : driver = DriverManager.getDriver(jdbcUrl)

activate "java.sql.DriverManager"
"java.sql.DriverManager" -> "java.sql.DriverManager": 触发类加载
"java.sql.DriverManager" -> "java.sql.DriverManager": 静态代码块执行loadInitialDrivers方法
"java.sql.DriverManager" -> java.util.ServiceLoader: ServiceLoader.load(Driver.class)
java.util.ServiceLoader -> java.util.ServiceLoader: 使用currentThread的contextClassLoader进行类加载

"java.util.ServiceLoader" -> "com.mysql.jdbc.Driver":触发类加载
"com.mysql.jdbc.Driver" -> "com.mysql.jdbc.Driver": 静态代码块执行注册：\nDriverManager.registerDriver(new Driver())
"com.mysql.jdbc.Driver" - -> "java.sql.DriverManager": 注册到 registeredDrivers
"java.sql.DriverManager" - -> util.DriverDataSource: 从注册的registeredDrivers中返回合适的driver
util.DriverDataSource - -> pool.PoolBase: set dadaSource field
deactivate "java.sql.DriverManager"
deactivate pool.PoolBase

pool.HikariPool- -> pool.PoolBase: newPoolEntry
pool.PoolBase-> pool.PoolBase: newConnection\n  1.dataSource.getConnection()\n  2.setupConnection \n  2.1设置validationTimeout，isReadOnly，isAutoCommit，transactionIsolation，schema\n  2.2 Execute isValid() or connection test query. 如果驱动支持JDBC4，HikariCP 强烈建议使用JDBC4做test \n  2.3 执行ConnectionInitSql 如果已经配置（默认没配置）
pool.PoolBase-> pool.PoolEntry:new PoolEntry(connection,pool)
pool.PoolEntry- ->pool.HikariPool:poolEntry
pool.HikariPool -> pool.HikariPool: poolEntry在lifetime后执行softEvictConnection
pool.HikariPool- -> pool.HikariPool: add to ConcurrentBag<PoolEntry>

pool.HikariPool->pool.HikariPool: registerMBeans

pool.HikariPool->pool.HikariPool: 初始化addConnectionExecutor给后续使用 \n 1.createPoolEntry \n 2.add to connectionBag
pool.HikariPool->pool.HikariPool: 初始化closeConnectionExecutor给后续使用 \n 1.quietlyCloseConnection \n 2. fillPool

pool.HikariPool->pool.HikariPool: 开启定时任务HouseKeeper维护最小空闲连接
pool.HikariPool->pool.HikariPool: 初始化泄露检查工厂类 ProxyLeakTaskFactory
pool.HikariPool->pool.HikariPool: 根据InitializationFailTimeout配置等待初始化

deactivate pool.HikariPool

HikariDataSource -> HikariDataSource: 标记seal= true 标记DS已经成功启动
deactivate HikariDataSource
@enduml

PlantUML version 1.2018.11(Sun Sep 23 00:43:53 CST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>